set(CMAKE_INSTALL_RPATH "\\$ORIGIN")

# sources
set(libotawa_SOURCES
	"feature.h"
	"base.cpp"
	"manager.cpp"
	"instruction.cpp"
	"type.cpp"
	"Loader.cpp"
	"BasicBlock.cpp"
	"CFGInfo.cpp"
	"CFG.cpp"
	"Edge.cpp"
	"PCGBlock.cpp"
	"PCGBuilder.cpp"
	"app_Application.cpp"
	"app_AddressOption.cpp"
	"ilp_Var.cpp"
	"ilp_Constraint.cpp"
	"ilp_System.cpp"
	"ilp_ILPPlugin.cpp"
	"proc_Processor.cpp"
	"proc_CFGProcessor.cpp"
	"proc_ContextualProcessor.cpp"
	"proc_DynFeature.cpp"
	"proc_DynProcessor.cpp"
	"proc_Feature.cpp"
	"proc_FeatureRequirer.cpp"
	"proc_LBlockProcessor.cpp"
	"proc_BBProcessor.cpp"
	"proc_ParamFeature.cpp"
	"proc_ParamProcessor.cpp"
	"proc_ProcessorException.cpp"
	"proc_ProcessorPlugin.cpp"
	"proc_Registry.cpp"
	"Process.cpp"
	"prop_AbstractIdentifier.cpp"
	"prop_ContextualProperty.cpp"
	"prop_DeletableProperty.cpp"
	"prop_Identifier.cpp"
	"prop_Property.cpp"
	"prop_PropList.cpp"
	"ipet_BasicConstraintsBuilder.cpp"
	"ipet_BasicObjectFunctionBuilder.cpp"
	"ipet_ConstraintLoader.cpp"
#	"ipet_parser.yy"
	"ipet_Delta.cpp"
	"ipet_FlowFactLoader.cpp"
	"ipet_FlowFactConstraintBuilder.cpp"
	"ipet_ILPSystemGetter.cpp"
	"ipet_IPET.cpp"
	"ipet_TimeDeltaObjectFunctionModifier.cpp"
	"ipet_TreePath.cpp"
	"ipet_TrivialBBTime.cpp"
	"ipet_TrivialDataCacheManager.cpp"
	"ipet_TrivialInstCacheManager.cpp"
	"ipet_VarAssignment.cpp"
	"ipet_WCETComputation.cpp"
	"ipet_WCETCountRecorder.cpp"
	"util_LoopInfoBuilder.cpp"
	"util_XSLTScript.cpp"
	"dfa_AbsIntLite.cpp"
	"dfa_IterativeDFA.cpp"
	"dfa_XCFGVisitor.cpp"
	"dfa_XIterativeDFA.cpp"
	"util_Dominance.cpp"
	"util_PostDominance.cpp"
	"util_ContextTree.cpp"
	"cfg_CFGAdapter.cpp"
	"cfg_CFGChecker.cpp"
	"cfg_CFGCheckSummer.cpp"
	"cfg_DelayedBuilder.cpp"
	"cfg_VirtualBasicBlock.cpp"
	"cfg_PSTBuilder.cpp"
	"cfg_LoopUnroller.cpp"
	"cfg_LoopReductor.cpp"
	"cfg_PFG.cpp"
	"cfg_PFGBuilder.cpp"
	"cfg_SpanningTreeBuilder.cpp"
	"cfg_SubCFGBuilder.cpp"
	"cfg_Virtualizer.cpp"
	"cfg_VirtualCFG.cpp"
	"cfg_CFGBuilder.cpp"
	"util_FlowFactLoader.cpp"
#	"util_fft_parser.yy"
#	"util_fft_lexer.ll"
	"util_CFGNormalizer.cpp"
	"util_DefaultFixPoint.cpp"
	"util_WideningFixPoint.cpp"
	"util_DefaultListener.cpp"
	"util_WideningListener.cpp"
	"util_FirstUnrollingFixPoint.cpp"
	"util_MemBlockMap.cpp"
	"util_UnrollingListener.cpp"
	"hard_Dumper.cpp"
	"hard_BHT.cpp"
	"hard_Processor.cpp"
	"hardware_Cache.cpp"
	"hardware_CacheConfiguration.cpp"
	"hardware_Platform.cpp"
	"hardware_PureCache.cpp"
	"cache_CCGBuilder.cpp"
	"cache_CCGConstraintBuilder.cpp"
	"cache_CCGDFA.cpp"
	"cache_CCGEdge.cpp"
	"cache_CCGNode.cpp"
	"cache_ACSBuilder.cpp"
	"cache_ACSMayBuilder.cpp"
	"cache_CAT2Builder.cpp"
	"cache_CAT2NCBuilder.cpp"
	"cache_CAT2ConstraintBuilder.cpp"
	"cache_CachePenalty.cpp"
	"cache_MUSTProblem.cpp"
	"cache_MAYProblem.cpp"
	"cache_PERSProblem.cpp"
	"cache_MUSTPERS.cpp"
	"cache_LinkedBlocksDetector.cpp"
	"cache_LBlock.cpp"
	"cache_FirstLastBuilder.cpp"
	"cache_LBlockSet.cpp"
	"cache_CachePenaltiesObjectFunctionBuilder.cpp"
	"branch_BranchBuilder.cpp"
	"branch_BranchProblem.cpp"
	"branch_CondNumber.cpp"
	"branch_ConsBuilder.cpp"
	"prog_File.cpp"
	"prog_FixedTextDecoder.cpp"
	"prog_ProgItem.cpp"
	"prog_Segment.cpp"
	"prog_Symbol.cpp"
	"prog_TextDecoder.cpp"
	"prog_VarTextDecoder.cpp"
	"prog_WorkSpace.cpp"
	"cache_CATBuilder.cpp"
	"cache_CATConstraintBuilder.cpp"
	"cache_CATDFA.cpp"
	"cache_CATNode.cpp"
	"util_LBlockBuilder.cpp"
	"util_Graph.cpp"
	"util_Node.cpp"
	"util_HalfAbsInt.cpp"
	"util_Edge.cpp"
	"util_GenGraph.cpp"
	"hard_Register.cpp"
	"sim_AbstractCacheDriver.cpp"
	"sim_CacheDriver.cpp"
	"sim_Simulator.cpp"
	"sim_State.cpp"
	"sim_TrivialSimulator.cpp"
	"sim_Driver.cpp"
	"sim_BasicBlockDriver.cpp"
	"sim_BBPathDriver.cpp"
	"BBTimeSimulator.cpp"
	"BBPath.cpp"
	"cfg_CFGCollector.cpp"
	"exegraph_ExeGraphBBTime.cpp"
	"exegraph_ExeGraph.cpp"
	"exegraph_LiExeGraphBBTime.cpp"
	"exegraph_LiExeGraph.cpp"
	"exegraph_Microprocessor.cpp"
	"exegraph_ParamExeGraph.cpp"
	"exegraph_ParamExeGraphBBTime.cpp"
	"parexegraph_ParExeProc.cpp"
	"parexegraph_Resource.cpp"
	"parexegraph_ParExeGraph.cpp"
	"parexegraph_GraphBBTime.cpp"
	"util_Trace.cpp"
	"loader_arm.cpp"
	"flowfact_ContextualLoopBound.cpp"
	"BBRatioDisplayer.cpp"
	"graph_PreorderIterator.cpp"
	"hard_Memory.cpp"
	"script_Script.cpp"
	"sem.cpp"
	"stats.cpp"
	"stats_BBStatCollector.cpp"
	"util_AccessedAddress.cpp"
	"util_StackAnalysis.cpp"
	"dcache_ACSBuilder.cpp"
	"dcache_BlockBuilder.cpp"
	"dcache_CatBuilder.cpp"
	"dcache_CatConstraintBuilder.cpp"
	"dcache_ACSMayBuilder.cpp"
	"clp_analysis.cpp"
	"clp_symbolic_expr.cpp"
	)

include_directories(".")

# generated sources by flex and bison
if(WIN32)
	BISON_FILE("ipet_parser.yy")
	list(APPEND libotawa_SOURCES ${OUTFILE})
	FLEX_FILE("ipet_lexer.ll")
	list(APPEND libotawa_SOURCES lex.${PREFIX}.c lex.${PREFIX}.h)

	BISON_FILE("util_fft_parser.yy")
	list(APPEND libotawa_SOURCES ${OUTFILE})
	FLEX_FILE("util_fft_lexer.ll")
	list(APPEND libotawa_SOURCES lex.${PREFIX}.c lex.${PREFIX}.h)
elseif(UNIX)
	BISON_TARGET(ipet_parser ipet_parser.yy ${CMAKE_CURRENT_BINARY_DIR}/ipet_parser.cpp COMPILE_FLAGS --defines=ipet_parser.h)
	FLEX_TARGET(ipet_lexer ipet_lexer.ll  ${CMAKE_CURRENT_BINARY_DIR}/ipet_lexer.cc)
	ADD_FLEX_BISON_DEPENDENCY(ipet_lexer ipet_parser)
	BISON_TARGET(util_fft_parser util_fft_parser.yy ${CMAKE_CURRENT_BINARY_DIR}/util_fft_parser.cpp COMPILE_FLAGS --defines=util_fft_parser.h)
	FLEX_TARGET(util_fft_lexer util_fft_lexer.ll  ${CMAKE_CURRENT_BINARY_DIR}/util_fft_lexer.cc)
	ADD_FLEX_BISON_DEPENDENCY(util_fft_lexer util_fft_parser)
	list(APPEND libotawa_SOURCES
		${BISON_ipet_parser_OUTPUTS}
		${FLEX_ipet_lexer_OUTPUTS}
		${BISON_util_fft_parser_OUTPUTS}
		${FLEX_util_fft_lexer_OUTPUTS})
endif()

# build
add_library(otawa SHARED ${libotawa_SOURCES})
target_link_libraries(otawa ${LIBELM})
target_link_libraries(otawa ${LIBGEL})
target_link_libraries(otawa ${LIBGEL_DWARF})

# installation
install(TARGETS otawa DESTINATION ${LIBDIR})
